<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Laura Taylor Design</title>
    <link href="/styles.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/jquery-1.3.2.min.js" type="text/javascript"></script>
    
    <% if @editing %>
      <!-- only need jquery-ui for moving and resizing things. -->
      <script src="/javascripts/jquery-ui-1.7.2.custom.min.js" type="text/javascript"></script>
      <link href="/javascripts/jquery-ui-1.7.2.custom.css" media="screen" rel="stylesheet" type="text/css" />
    <% end %>

    <script type="text/javascript">                                         
      $(document).ready(function() {
        <% if @editing %>
          $().mousemove(function(e){
            $('#mouse_position').html(e.pageX +', '+ e.pageY);
          }); 

          $("#save").click(function () {
            var query = new Array();

            // Make a query with all the elements' positions and sizes
            $(".element").each(function() {
              query.push([
                $(this).attr('id'),
                $(this).width(),
                $(this).height(),
                $(this).position().left,
                $(this).position().top
              ]);
            });

            $.post('/save/<%= @page.name %>', {'elements[]': query});
          });

          // Functions for drag and resize events
          change_start = function(event, ui) { $('#element_details').show(); };
          change_stop  = function(event, ui) { $('#element_details').hide(); };
          change = function(event, ui) { 
              $('#element_size').html($(this).width().toString() + ',' + $(this).height().toString());
              $('#element_position').html($(this).position().left.toString() + ',' + $(this).position().top.toString());
          };

          $('.element').addClass('editable');

          $(".element").draggable({
            grid: [10,10],
            start: change_start,
            stop: change_stop,
            drag: change
          });

          $(".element").resizable({
            autoHide: true,
            aspectRatio: $('#aspect').attr("checked"),
            start: change_start,
            stop: change_stop,
            resize: change
          });


          // Control resize aspect locking with aspect checkbox
          $('#aspect').change(function () {
            // Hackety hack. Due to bug http://dev.jqueryui.com/ticket/4186
            // I can't change the aspect ratio after create. Instead, have to
            // destroy and recreate the resizable.
            $('.element').resizable('destroy');
            $('.element').resizable({
              autoHide: true,
              aspectRatio: $(this).attr("checked"),
              start: change_start,
              stop: change_stop,
              resize: change
            });
          });
        <% end %>


        currentSection = null;
        currentLink = null;

        $(".section .title").click(function () {
          var oldSection = currentSection;
          currentSection = $(this);

          if (oldSection && currentSection[0] == oldSection[0]) return;

          $.ajax({url: "/show/" + $(this).html(), cache: false, success: function(html){
            $("#main").fadeOut("normal", function() {
              $("#main").html(html);
              $("#main").fadeIn("normal");
            });
          } });

          if (!oldSection) {
            currentSection.next().slideDown("slow");
          } else {
            oldSection.next().slideUp("slow", function() {
              currentSection.next().slideDown("slow");
            });
          }
        });

        $(".link a").click(function () {
          var oldLink = currentLink;
          currentLink = $(this);

          if (oldLink && currentLink[0] == oldLink[0]) return;

          if (oldLink) oldLink.css("color", "#93b2b6");
          $(this).css("color", "#7e7e7e");

          // Fix jump slidedowns by setting a height
          currentLink.next().show();
          var h = currentLink.next().height();
          currentLink.next().hide();

          if (!oldLink) {
            currentLink.next().height(h).slideDown("slow");
          } else {
            oldLink.next().slideUp("slow", function() {
              currentLink.next().height(h).slideDown("slow");
              // Make sure the old one actually is hidden. This can happen
              // when clicking a link in another section, then jumping back
              oldLink.next().css('display', 'none');
            });

            }
          });
      });
  </script> 
  </head>

<body>
  <div id="content">
    <div id="left">
      <% if @editing %>
        <div id="toolbox">
          Position: <span id="mouse_position">0,0</span>
          <label for="aspect">Lock aspect</label><input type="checkbox" id="aspect" checked="checked" />
          <button id="save">save</button>
          <div id="element_details" style="display: none;">
            Top-left: <span id="element_position">0,0</span>
            Size: <span id="element_size">0,0</span>
          </div>
        </div>
      <% end %>

      <img src="/logo.png" id="logo" alt="logo" />

      <% @pages.each do |page| %>
        <div class="section">
          <a href="#" onClick="return false;" class="title"><%= page.name %></a>
          <div class="links">
            <div class="link">
              <a href="#" onClick="return false;">Paper Rocks Scissors For Multimedia</a>
              <div class="description">
                In the time of chimpanzees I was a monkey
                Butane in my veins and I'm out to cut the junkie
                With the plastic eyeballs, spray-paint the vegetables
                Dog food stalls with the beefcake pantyhose
                Kill the headlights and put it in neutral
                Stock car flamin' with a loser and the cruise control
                Baby's in reno with the vitamin d
                Got a couple of couches
              </div> 
            </div>
            <div class="link">
              <a href="#" onClick="return false;">True Type Project</a>
              <div class="description">
                In the time of chimpanzees I was a monkey
                Butane in my veins and I'm out to cut the junkie
                With the plastic eyeballs, spray-paint the vegetables
                Dog food stalls with the beefcake pantyhose
                Kill the headlights and put it in neutral
                Stock car flamin' with a loser and the cruise control
                Baby's in reno with the vitamin d
                Got a couple of couches
              </div> 
            </div>
            <div class="link">
              <a href="#" onClick="return false;">Unicorns + Ponies for Purple Rainbow Cars</a>
              <div class="description">
                In the time of chimpanzees I was a monkey
                Butane in my veins and I'm out to cut the junkie
                With the plastic eyeballs, spray-paint the vegetables
                Dog food stalls with the beefcake pantyhose
                Kill the headlights and put it in neutral
                Stock car flamin' with a loser and the cruise control
                Baby's in reno with the vitamin d
                Got a couple of couches
              </div> 
            </div>
            <div class="link">
              <a href="#" onClick="return false;">Hot Pants and Glitter</a>
              <div class="description">
                In the time of chimpanzees I was a monkey
                Butane in my veins and I'm out to cut the junkie
                With the plastic eyeballs, spray-paint the vegetables
                Dog food stalls with the beefcake pantyhose
                Kill the headlights and put it in neutral
                Stock car flamin' with a loser and the cruise control
                Baby's in reno with the vitamin d
                Got a couple of couches
              </div> 
            </div>
          </div>
        </div>
      <% end %>
    </div>

  <div id="main">
    <%= yield %>
  </div>
</div>
</body>
</html>
